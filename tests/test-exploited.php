<?php
use \Symfony\Component\Finder\SplFileInfo;

class ExploitedTest extends PHPUnit_Framework_TestCase {

  function testExploited() {
    $check = new \Pantheon\Checks\Exploited();
    $file = new SplFileInfo(dirname(__FILE__).'/data/exploited.php', dirname(__FILE__).'/data/', './exploited.php');
    $check->run($file);
    $this->assertEquals($check->alerts[0]['data'][0], './exploited.php');
    $this->assertEquals($check->alerts[0]['data'][1], '2');
    $this->assertEquals($check->alerts[0]['data'][2], 'eval(base64_decode("ZXJyb3JfcmVwb3J0aW5nKDApOwokcW');
    $this->assertEquals(1, count($check->alerts));
  }

  function testExploitedFalsePositives() {
    $check = new \Pantheon\Checks\Exploited();
    $file = new SplFileInfo(dirname(__FILE__).'/data/exploited-false.php', dirname(__FILE__).'/data/', './exploited-false.php');
    $check->run($file);
    $this->assertTrue(empty($check->alerts));
  }
}
